<!doctype html>
<html>
  <head>
    <title>WebSocket Test</title>
  </head>
  <body>
    <h1>WebSocket Connection Test</h1>
    <div id="messages"></div>
    <input
      type="text"
      id="symbolInput"
      placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–∏–º–≤–æ–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä: BTC-USDT)"
      value="BTC-USDT"
    />
    <button onclick="connectWS()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å</button>
    <button onclick="sendSubscribe()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å Subscribe</button>

    <script>
      let ws = null;

      function logMessage(message) {
        const div = document.createElement("div");
        div.textContent = message;
        document.getElementById("messages").appendChild(div);
        console.log(message);
      }

      function connectWS() {
        if (ws) {
          ws.close();
        }

        const symbol = document.getElementById("symbolInput").value;
        const wsUrl = `ws://localhost:8001/ws/ohlcv/${symbol}/1h/`;
        logMessage(`–ü–æ–¥–∫–ª—é—á–∞—é—Å—å –∫: ${wsUrl}`);

        ws = new WebSocket(wsUrl);

        ws.onopen = function (event) {
          logMessage("‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!");
        };

        ws.onmessage = function (event) {
          logMessage("üì• –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: " + event.data);
        };

        ws.onerror = function (error) {
          logMessage("‚ùå –û—à–∏–±–∫–∞: " + error);
        };

        ws.onclose = function (event) {
          logMessage(
            "üîå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ. –ö–æ–¥: " +
              event.code +
              ", –ø—Ä–∏—á–∏–Ω–∞: " +
              event.reason,
          );
        };
      }

      function sendSubscribe() {
        if (ws && ws.readyState === WebSocket.OPEN) {
          ws.send(JSON.stringify({ action: "subscribe" }));
          logMessage("üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω subscribe –∑–∞–ø—Ä–æ—Å");
        } else {
          logMessage("‚ö†Ô∏è WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω");
        }
      }
    </script>
  </body>
</html>
